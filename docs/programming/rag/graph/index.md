# GraphRAG

一种 利用知识图谱结构增强检索与生成质量的新型 RAG 范式，由微软于 2024 年提出（Microsoft GraphRAG Paper）

### 一、传统 RAG 的局限（GraphRAG 要解决的问题）

| 问题                          | 说明                                                                |
| ------------------------------- | --------------------------------------------------------------------- |
| **1. 检索结果碎片化**   | 返回的是孤立文本块（chunks），丢失实体间关系                        |
| **2. 难以支持多跳推理** | 例如：“A 公司的 CEO 曾在哪家大学任教？” → 需先找 CEO，再找其履历 |
| **3. 全局信息缺失**     | 无法回答“社区发现”类问题，如“本领域有哪些主要研究派系？”        |
| **4. 噪声敏感**         | 相似 query 可能召回不同片段，答案不一致                             |

> 📌 传统 RAG 是 ​**“关键词/向量匹配 → 文本片段 → 生成”**​，缺乏对**结构化语义网络**的利用。


### 二、GraphRAG 的核心思想

**将原始非结构化文本 → 构建知识图谱 → 基于图结构进行社区检测与摘要 → 检索时利用图拓扑增强上下文**

#### 关键步骤：

1. **从原始文档中提取实体与关系**
    * 使用 LLM 抽取 `(实体, 关系, 实体)` 三元组
    * 构建大规模异构知识图谱（节点=实体，边=关系）
2. **对图进行社区划分（Community Detection）**
    * 使用 Leiden 等算法将图划分为语义紧密的“社区”（如“量子计算研究团队”、“某公司高管圈”）
3. **为每个社区生成摘要**
    * 调用 LLM 对社区内所有实体和关系生成自然语言摘要
    * 例如：“该社区包含张三（清华教授）、李四（学生），研究方向为超导材料...”
4. ​**查询时分层检索**​：
    * ​**第一层**​：根据用户 query 检索最相关的 **社区摘要**
    * ​**第二层**​（可选）：在相关社区内检索具体实体/关系/原文片段
5. **将图结构信息注入 Prompt**
    * 不仅给 LLM 文本，还提供“社区上下文 + 实体关系路径”，支持多跳推理

---

### 三、GraphRAG vs “RAG + 知识图谱” 的区别

| 维度                       | 普通 “RAG + KG”                   | GraphRAG                                               |
| ---------------------------- | ------------------------------------- | -------------------------------------------------------- |
| **图的作用**         | 仅用于辅助检索（如扩展 query 实体） | 图是​**核心索引结构**​，驱动整个检索与生成流程 |
| **是否生成社区摘要** | ❌ 否                               | ✅ 是（关键创新）                                      |
| **支持全局问答**     | ❌ 仅支持局部事实                   | ✅ 支持“领域概览”“群体分析”等全局问题              |
| **是否端到端构建图** | 通常依赖预构建 KG（如 Wikidata）    | ✅ 从原始文本自动构建图（无需外部 KG）                 |
| **适用数据**         | 结构化/半结构化数据                 | ​**纯非结构化文本**​（如新闻、论文、企业文档） |

> ✅ ​**GraphRAG 的本质**​：
> **用 LLM 从文本中自动构建“语义地图”，再用这张地图指导 LLM 更聪明地回答问题。**

---

### 四、GraphRAG 能解决什么问题？（典型场景）

| 问题类型                       | 传统 RAG                   | GraphRAG               |
| -------------------------------- | ---------------------------- | ------------------------ |
| “A 和 B 有什么合作？”        | 可能漏召回（若无共现段落） | 通过图路径发现间接关系 |
| “这个领域的主要人物有哪些？” | 无法回答（无单一文档描述） | 返回相关社区摘要       |
| “总结某事件的参与方及角色”   | 片段分散，LLM 难整合       | 社区摘要已结构化聚合   |
| “谁是 X 的导师？”（多跳）    | 需多次 RAG 或 Agent        | 单次检索图路径即可     |

---

### 五、局限与挑战

* ​**构建成本高**​：需对全量文本做 LLM 三元组抽取 + 图构建（计算密集）
* ​**更新复杂**​：新增文档需增量更新图结构
* ​**小规模数据收益有限**​：适合 >10K 文档的 corpus
* ​**依赖 LLM 抽取质量**​：噪声三元组会影响图质量

---

### ✅ 总结

> **GraphRAG 不是“RAG + 知识图谱”的简单叠加，而是一种以“图为中心”的新一代 RAG 架构。**
>
> * 它**从原始文本自动构建知识图谱**
> * 通过**社区检测与摘要**实现全局语义理解
> * 特别擅长回答**复杂、多跳、全局性**问题
> * 是传统 RAG 在**深度推理场景**下的重要演进

如果你的场景涉及 **企业知识库分析、科研文献综述、情报挖掘、事件溯源** 等复杂任务，GraphRAG 值得深入探索；若只是简单问答，传统 RAG 仍更高效。
