import{_ as e,I as n,c as l,o as p,j as a,J as r,a9 as t,a as d,e1 as h,e2 as o,e3 as c,e4 as k,e5 as g,e6 as b,e7 as u,e8 as m,e9 as F,ea as y,eb as C}from"./chunks/framework.Dp2GimK2.js";const A=JSON.parse('{"title":"编译 JDK","description":"","frontmatter":{},"headers":[],"relativePath":"programming/java/source-code/index.md","filePath":"programming/java/source-code/index.md","lastUpdated":1765356475000}'),_={name:"programming/java/source-code/index.md"};function D(f,s,B,v,J,K){const i=n("ArticleMetadata");return p(),l("div",null,[s[0]||(s[0]=a("h1",{id:"编译-jdk",tabindex:"-1"},[d("编译 JDK "),a("a",{class:"header-anchor",href:"#编译-jdk","aria-label":"Permalink to “编译 JDK”"},"​")],-1)),r(i),s[1]||(s[1]=t('<p>我们做 Java 开发，第一件事就是要安装 JDK，因为它包含了编译和运行 Java 程序所需的工具和库。下载的 JDK 是由源码编译成可执行的二进制文件，那么我们也可以对源码进行修改，然后编译成我们自己的 JDK。说干就干。</p><h2 id="_1-获取-jdk-源码" tabindex="-1">1. 获取 JDK 源码 <a class="header-anchor" href="#_1-获取-jdk-源码" aria-label="Permalink to “1. 获取 JDK 源码”">​</a></h2><p><a href="https://openjdk.org/" target="_blank" rel="noreferrer">OpenJDK</a> 是 Java 官方开源版本，另外各大厂商和社区基于开源的代码进行二次开发，形成了很多<strong>下游发行版</strong>，比如：<code>Azul Zulu</code>、<code>Amazon Corretto</code>、<code>Eclipse Temurin</code>等。</p><p>其中，<code>Eclipse Temurin</code>是由<code>Eclipse 基金会</code>下的<code>Adoptium</code>社区维护的开源 JDK 发行版，它完全免费，提供不输于商业 JDK 的性能和稳定性，被业界广泛认可与采用，我们这里就使用它的源码进行编译。<a href="https://adoptium.net/zh-CN/" target="_blank" rel="noreferrer">官方网站</a></p><p><img src="'+h+'" alt="" loading="lazy"></p><h2 id="_2-编译-jdk" tabindex="-1">2. 编译 JDK <a class="header-anchor" href="#_2-编译-jdk" aria-label="Permalink to “2. 编译 JDK”">​</a></h2><p>假如想编译<code>JDK 8</code>，那本机必须最起码得有一个<code>JDK 7</code>或者更新一点的版本（Boot JDK）；你想编译<code>JDK 11</code>，那就要求本机必须装有<code>JDK 10</code>或者<code>11</code>。</p><p>我现在下载的是<code>JDK 17</code>的源码包，并且我们本地也安装了<code>JDK 17</code>，所以可以直接编译<code>JDK 17</code>。</p><p>下载后解压，进入解压目录，执行以下命令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这条命令是用来检查你的系统环境，生成适合本机编译的 Makefile 和编译选项。可能会报错，提示缺少依赖项：<code>autoconf</code>、<code>make</code>、<code>gcc</code>等，按照提示安装缺少的依赖项：</p><p><img src="'+o+'" alt="" loading="lazy"></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autoconf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>再次执行<code>bash configure</code>命令，可能还会提示如下错误：</p><p><img src="'+c+'" alt="" loading="lazy"></p><p>这是因为我当前的系统是<code>MacOS</code>，而在<code>MacOS</code>上编译 JDK 需要 Apple 的 SDK（头文件 + 系统框架）与<code>xcodebuild</code>工具，这就需要安装<code>Xcode</code>，可以从<code>App Store</code>下载安装：</p><p><img src="'+k+`" alt="" loading="lazy"></p><p>注意：可能已经安装了<code>Xcode Command Line Tools</code>（轻量版），这也是不行的，必须安装完整的<code>Xcode</code>。</p><p>安装完成后，“激活”安装的<code>Xcode</code>，执行以下命令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 接受 Xcode 许可协议，执行后需要回车一次和输入\`agree\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xcodebuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -license</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 告诉系统当前要使用哪个 Xcode（开发环境）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xcode-select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --switch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /Applications/Xcode.app/Contents/Developer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xcodebuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出示例</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Xcode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26.0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 17A400</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>再次执行<code>bash configure</code>命令，不过这次需要加上<code>--with-sysroot</code>参数，指定 Apple SDK 的路径：</p><div class="language-bashbash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bashbash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>bash configure --with-sysroot=$(xcrun --show-sdk-path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>又可能提示错误：</p><p><img src="`+g+`" alt="" loading="lazy"></p><p>这是因为 JDK 内部的 Java 2D、OpenGL、Metal Pipeline 需要链接一些 Metal 头文件或工具，这里我们直接跳过，顺便加上<code>--disable-warnings-as-errors</code>参数，表示禁止把警告当作错误：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  METAL=/usr/bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  METALLIB=/usr/bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --with-sysroot=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xcrun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --show-sdk-path)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --disable-warnings-as-errors</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>执行后，输出如下内容，则表示配置成功：</p><p><img src="`+b+'" alt="" loading="lazy"></p><p>接下来，才是真正的编译，执行以下命令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+u+'" alt="" loading="lazy"></p><p>编译后的 JDK 会生成在<code>build/macosx-x64-server-release/jdk</code>目录下：</p><p><img src="'+m+'" alt="" loading="lazy"></p><p>这不就是我们平时下载的 JDK 目录结构嘛，我们可以进入<code>bin</code>目录，执行<code>java -version</code>命令，查看编译后的 JDK 版本：</p><p><img src="'+F+'" alt="" loading="lazy"></p><h2 id="_3-idea-导入源码" tabindex="-1">3.IDEA 导入源码 <a class="header-anchor" href="#_3-idea-导入源码" aria-label="Permalink to “3.IDEA 导入源码”">​</a></h2><p>打开IDEA，选择<code>File -&gt; New -&gt; Project from Existing Sources...</code>，选择源码目录，后面的步骤中会提示选择 SDK，也不要选择，把可选的 SDK 删除掉，点击<code>Next</code>即可：</p><p><img src="'+y+'" alt="" loading="lazy"></p><p>目前就导入成功了，可以愉快地阅读和修改源码了，如果发现某些类有红色报错，可能是模块没有关联，鼠标悬浮上去，点击<code>Add Module Dependency</code>即可：</p><p><img src="'+C+'" alt="" loading="lazy"></p>',40))])}const E=e(_,[["render",D]]);export{A as __pageData,E as default};
